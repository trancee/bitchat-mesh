# Testing

This document summarizes the test commands and the current test suites for each platform, plus a coverage status note.

## Android

### Command

```bash
cd android
./gradlew :bitchat-mesh:test
./gradlew :bitchat-mesh:connectedDebugAndroidTest
./gradlew :bitchat-mesh:jacocoFullReport
```

### Test suites

- JUnit Jupiter unit tests under `android/bitchat-mesh/src/test/kotlin`
  - `com.bitchat.mesh.MeshListenerTests`
  - `com.bitchat.mesh.MeshManagerTests`
- Android instrumentation tests under `android/bitchat-mesh/src/androidTest/kotlin`
  - `com.bitchat.android.crypto.EncryptionServiceInstrumentationTests`
  - `com.bitchat.android.features.file.FileUtilsInstrumentationTests`
  - `com.bitchat.android.identity.SecureIdentityStateManagerInstrumentationTests`
  - `com.bitchat.android.mesh.BluetoothConnectionTrackerInstrumentationTests`
  - `com.bitchat.android.mesh.BluetoothPermissionManagerInstrumentationTests`
  - `com.bitchat.android.mesh.PeerFingerprintManagerInstrumentationTests`
  - `com.bitchat.android.mesh.PowerManagerInstrumentationTests`
  - `com.bitchat.android.noise.NoiseEncryptionServiceInstrumentationTests`
  - `com.bitchat.android.noise.NoiseSessionManagerInstrumentationTests`
  - `com.bitchat.android.services.SeenMessageStoreInstrumentationTests`
  - `com.bitchat.android.services.VerificationServiceInstrumentationTests`
  - `com.bitchat.android.utils.DeviceUtilsInstrumentationTests`

### Coverage

- Coverage is generated by the `jacocoFullReport` task (unit + instrumentation).
- `jacocoTestReport` remains unit-test-only.
- Report excludes the upstream `com.bitchat.android.noise.southernstorm` package and Bluetooth stack classes.
- Last updated: 2026-02-14
- Jacoco totals (unit + instrumentation):
  - Instruction: 23179/32560 (71.19%)
  - Line: 3600/4914 (73.26%)
  - Branch: 1796/3286 (54.66%)
  - Complexity: 1110/2601 (42.68%)
  - Method: 624/919 (67.90%)
  - Class: 117/157 (74.52%)

## iOS

### Command

```bash
cd ios
swift test
swift test --enable-code-coverage
xcrun llvm-profdata merge -sparse .build/debug/codecov/*.profraw -o .build/debug/codecov/default.profdata
xcrun llvm-cov report \
  .build/debug/BitchatMeshPackageTests.xctest/Contents/MacOS/BitchatMeshPackageTests \
  -instr-profile .build/debug/codecov/default.profdata
```

### Test suites

- Swift Package tests under `ios/Tests/BitchatMeshTests`
  - `BinaryEncodingUtilsTests`
  - `BinaryProtocolTests`
  - `BitchatFilePacketTests`
  - `IntegrationMessagingTests`
  - `MeshEndToEndCompatibilityTests`
  - `MeshListenerTests`
  - `MeshManagerTests`
  - `MeshServicesTests`
  - `MoreCoverageTests`
  - `NoiseAndSyncManagerTests`
  - `ProtocolAndNoiseTests`
  - `RouteForwardingTests`
  - `TLVPacketTests`
  - `UtilsAndSyncTests`

### Coverage

- Coverage is reported via `xcrun llvm-cov report`.
- Last updated: 2026-02-14
- llvm-cov totals:
  - Regions: 52.68%
  - Functions: 63.27%
  - Lines: 57.24%
